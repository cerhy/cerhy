<link  type="text/css" rel="stylesheet" href="/${res}/css/jquery.mloading.css" />
<link  href="/${res}/css/jquery.mloading.less" />
<script  type="text/javascript" src="/${res}/js/jquery.mloading.js"></script>
<style type="text/css">
.sub2 {
	width: 55px;
	height: 30px;
	background: #00a8eb;
	color: #FFF;
	text-align: center;
	font-size: 14px;
	border-radius: 3px;
}

.sub2:hover {
	background: #14bdff;
}

</style>
<script type="text/javascript">
$(function(){
$('.user-menu-links li').click(function(){
    $(this).toggleClass('on');
});
});
</script>
<style>
.st_tree ul .change a:hover{color:red;}
.st_tree ul li a:hover{color:blue;}
.st_tree ul .change :hover{background-color:#e7e7e7 }
::-webkit-scrollbar{width:0px}
.clear{clear:both}
.st{
transition: all 0.30s ease-in-out;
border: 1px solid gray;
}
.st:focus{
border: 1px solid #66AACC;
box-shadow: 0 0 5px #66AACC;
outline: none;
}
.sub2 {
	width:100px;
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 3px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    -webkit-transition-duration: 0.4s; /* Safari */
    transition-duration: 0.4s;
}

.sub2:hover {
    box-shadow: 0 3px 4px 0 rgba(0,0,0,0.24),0 8px 30px 0 rgba(0,0,0,0.19);
}
</style>
<div id="contextMenus"></div>
				<div class="personCenter-userInfo blog_right">
					<div class="tggl">
						<form action="updateColumn.jspx?id=${column.columnId}" id="jvForm" method="post" >
							<div >
							<span style="font-size:16px;">栏目名:&nbsp;&nbsp;&nbsp;&nbsp;</span>
							<input style="display: none;" id="twoState" name="twoState" value="${twoState}"/>
							<input style="display: none;" id="ccId" name="ccId" value="${column.columnId}"/>
							<input style="display: none;" id="columsLevel" name="columsLevel" value="${column.columsLevel}"/>
							[#if column.parentId??]
							<input style="display: none;" id="parentId" name="parentId" value="${column.parentId.columnId}"/>
							[#else]
							<input style="display: none;" id="parentId" name="parentId" value=""/>
							[/#if]
							<input class="st" id="updateName" type="text" maxlength="15" name="updateName" value="${column.columnName}" required="required" style="margin:10px 0;width: 180px;height: 30px;" required="required" oninvalid="setCustomValidity('请输入栏目名称');" oninput="setCustomValidity('');" maxlength="60"/><span style="color:#f00; margin-left:10px;">*</span>
							</div>
							<div >
							[#if column.uniqueCode??]
								<span style="font-size:16px;">验证码:&nbsp;&nbsp;&nbsp;&nbsp;</span>
								<input class="st" type="text" style="width: 180px;height: 30px;" id="uniqueCode" name="uniqueCode" [#if joinStatus=0]readonly="readonly"[/#if] value="${column.uniqueCode!''}"/>
								<span style="color:#f00;margin-left:10px;">设置验证码后，栏目可作为群组,为空则变为普通栏目</span>
								<br />
								<span style="color:#f00;">（当群组已有人加入时,验证码将不可以修改）</span>
							[#else]
								<span style="font-size:16px;">验证码:&nbsp;&nbsp;&nbsp;&nbsp;</span>
								<input class="st" type="text" style="width: 180px;height: 30px;" id="uniqueCode" name="uniqueCode" value=""/>
								<span style="color:#f00;margin-left:10px;">设置验证码后，栏目可作为群组</span>
							[/#if]
							</div>
							<div >
							<span style="font-size:16px;">栏目序号:&nbsp;</span>
							<input class="st"  type="text" id="updateOrderId" name="updateOrderId" value="${column.orderId}"  style="margin:10px 0;width: 180px;height: 30px;" required="required" oninvalid="setCustomValidity('请输入栏目序号');" oninput="setCustomValidity('');" maxlength="60"/> 
							</div>
							<div style="margin: 20px 0"> <input type="button" value="更新" class="submit" id="submit" onclick="updateColumnRefresh()" /> </div>
						</form>
					</div>
				</div>
<script type="text/javascript">
function updateColumnRefresh(){
        	var ccId=$("#ccId").val();
        	var regs = new RegExp("[~'!@#$%^&*-+_=:]"); 
            var columnInput = $('#updateName').val();
            if(columnInput.replace(/\s+/g,"")==''){
            	alert("请填写栏目名称。");
        		return false;
            }else if(regs.test(columnInput)){
        		alert("栏目名称可能包含%/等特殊字符，请修改重试。");
        		return false;
            }else{
        		var reg = new RegExp("^[0-9]*$");
        		var uniqueCode = $('#uniqueCode').val();
        	    if(!reg.test(uniqueCode)){
        			alert("验证码为数字类型!");
        			return false;
        	    }else{
        	    	var twoState=$("#twoState").val();
        			var uniqueCode=$("#uniqueCode").val();
        			if(twoState==1&&uniqueCode!=''){
        				alert("该操作不被允许!\r\n该栏目下已存在子栏目,不可作为群组!验证码不可填!");
        				return false;
        			}else{
        				if(uniqueCode!=""){
            		    	var obj = $(this);
            		    	$.ajax({
            		    		url:"${base}/blog/checkGroupCode.jspx?code="+uniqueCode+"&columnId="+ccId,
            		    		type:"POST",
            		    		dataType:"json",
            		    		data: "",
            		    		success: function (data) {
            		    			if(data.status==1){
            		    				alert("验证码已存在!");
            		    				return false;
            		    			}else{
            		    				$("body").mLoading();
            		    				$.ajax({
            	        		    		url:"${base}/blog/columns_updates_refresh.jspx",
            	        		    		type:"POST",
            	        		    		dataType:"json",
            	        		    		 data : {'id' : $("#ccId").val(),'columsLevel':$("#columsLevel").val(),'updateName':$("#updateName").val(),'updateOrderId':$("#updateOrderId").val(),'uniqueCode':$("#uniqueCode").val(),'parentId':$("#parentId").val()},
            	        		    		success: function (data) {
            	        		    			if(data.status==1){
            	        		    				alert("栏目更新失败");
            	        		    				return false;
            	        		    			}else{
            	        		    				$.ajax({
            	        		    			           type: 'GET',
            	        		    			           url : '${base}/blog/refreshColumn.jspx',
            	        		    			           dataType:"html",
            	        		    			           async: true,
            	        		    			           success : function(datas){
            	        		    			        	   $("#appendHtml").empty();
            	        		    			        	   $("#joinGroups").remove();
            	        		    			               $("#appendHtml").append(datas);
            	        		    			               if(window._bd_share_main){
            	        		    			            	   window._bd_share_main.init();
            	        		    			            	}
            	        		    			               $("body").mLoading("hide");
            	        		    			  	   		 }
            	        		    			 	});
            	     		                        return true;
            	        		    			}
            	        		            }
            	        		    	});
            		    			}
            		            }
            		    	});
            		    	return false;
            		     }else{
            		    	 $("body").mLoading();
            		    	 $.ajax({
 	        		    		url:"${base}/blog/columns_updates_refresh.jspx",
 	        		    		type:"POST",
 	        		    		dataType:"json",
 	        		    		 data : {'id' : $("#ccId").val(),'columsLevel':$("#columsLevel").val(),'updateName':$("#updateName").val(),'updateOrderId':$("#updateOrderId").val(),'uniqueCode':$("#uniqueCode").val(),'parentId':$("#parentId").val()},
 	        		    		success: function (data) {
 	        		    			if(data.status==1){
 	        		    				alert("栏目更新失败");
 	        		    				return false;
 	        		    			}else{
 	        		    				$.ajax({
 	        		    			           type: 'GET',
 	        		    			           url : '${base}/blog/refreshColumn.jspx',
 	        		    			           dataType:"html",
 	        		    			           async: true,
 	        		    			           success : function(datas){
 	        		    			        	   $("#appendHtml").empty();
 	        		    			        	   $("#joinGroups").remove();
 	        		    			               $("#appendHtml").append(datas);
 	        		    			               if(window._bd_share_main){
 	        		    			            	   window._bd_share_main.init();
 	        		    			            	}
 	        		    			              $("body").mLoading("hide");
 	        		    			  	   		 }
 	        		    			 	});
 	     		                        return true;
 	        		    			}
 	        		            }
 	        		    	});
            		     }
        				return false;
        			}	
        	    }
            }
        }
</script>